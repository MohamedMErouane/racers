<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>racers.fun - Waifu Racing Battles</title>
    <link rel="icon" type="image/png" href="images/ui/favicon.png">
    <link rel="stylesheet" href="styles.css">
    <!-- Add CSS for pulse animation -->
    <style>
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div id="animatedBg"></div>
    <div class="particles" id="particles"></div>

    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Summoning Waifus...</div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="logo">
            <h1>racers.fun</h1>
        </div>
        <div class="wallet-controls">
            <button class="wallet-btn" id="walletBtn">Connect</button>
            <div class="wallet-actions" id="walletActions">
                <button class="deposit-btn" id="depositBtn">Deposit</button>
                <button class="withdraw-btn" id="withdrawBtn">Withdraw</button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Chat Panel -->
        <div class="chat-panel" id="chatPanel">
            <div class="chat-collapse-btn" id="chatCollapseBtn">
                <div class="notification-badge" id="notificationBadge">3</div>
                <span class="collapse-icon">‚óÄ</span>
            </div>
            <div class="chat-header">
                <div class="online-indicator">
                    <div class="online-dot"></div>
                    <span>Online: <span id="onlineCount">1337</span></span>
                </div>
            </div>
            <div class="chat-messages" id="chatMessages"></div>
            <div class="chat-input-container">
                <input type="text" id="chatInput" class="chat-input" placeholder="Connect wallet to chat..." disabled>
            </div>
            <div class="chat-rules" id="chatRules">
                <div class="solana-price">
                    <span class="price-label">‚óé</span>
                    <span class="price-value" id="solanaPrice">$0.00</span>
                </div>
                <div class="rules-icons">
                    <span>üîä</span>
                    <span>‚ùì</span>
                    <span>‚öñÔ∏è</span>
                </div>
            </div>
            
        </div>

        <!-- Game Panel -->
        <div class="game-panel">
            <div class="race-info">
                <div class="race-header">
                    <h2>Race #<span id="raceNumber">1</span></h2>
                    <span>Next race in: <span id="nextRaceTime">60s</span></span>
                </div>
                <div class="race-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="totalPot">0 SOL</div>
                        <div class="stat-label">Total Pot</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalBets">0</div>
                        <div class="stat-label">Total Bets</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="myBets">0 SOL</div>
                        <div class="stat-label">My Bets</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="userBalance">100.0 SOL</div>
                        <div class="stat-label">My Balance</div>
                    </div>
                </div>
            </div>

            <div class="race-track-container">
                <!-- Update your HTML structure for better layout -->
                <div id="raceContainer" style="display: none; height: 80vh; width: 100%;">
                  <div class="race-display">
                    <!-- Positions Display -->
                    <div id="positionsDisplay"></div>
                    
                    <!-- Canvas Container -->
                    <div class="canvas-container">
                      <canvas id="raceCanvas"></canvas>
                    </div>
                    
                    <!-- Speed Display -->
                    <div id="speedDisplay"></div>
                  </div>
                </div>
            </div>

            <!-- Winner Modal -->
            <div class="winner-modal" id="winnerModal">
                <div class="winner-content">
                    <button class="close-winner-btn" id="closeWinnerBtn"></button>
                    <div class="winner-left">
                        <h2 class="victory-title">VICTORY!</h2>
                        <div class="winner-racer" id="winnerDisplay">
                            <img class="winner-racer-avatar" id="winnerAvatar" src="" alt="Winner">
                            <div class="winner-racer-name" id="winnerName">Character Name</div>
                        </div>
                        <div class="winner-buttons">
                            <button class="winner-btn">Download Image</button>
                            <button class="winner-btn">Share to Twitter</button>
                        </div>
                    </div>
                    <div class="winner-right">
                        <div class="race-statistics">
                            <h3>Race Statistics</h3>
                            <div class="pot-summary">
                                <h4>Pot Summary</h4>
                                <div class="pot-item">
                                    <span class="label">Total Pot:</span>
                                    <span class="value" id="modalTotalPot">0.00 SOL</span>
                                </div>
                                <div class="pot-item">
                                    <span class="label">Winner:</span>
                                    <span class="value" id="modalWinnerName">Character</span>
                                </div>
                            </div>
                            <div class="top-winners">
                                <h4>Top Winners</h4>
                                <div class="top-winner-item">
                                    <span>#1 ---</span>
                                    <span>---</span>
                                </div>
                                <div class="top-winner-item">
                                    <span>#2 ---</span>
                                    <span>---</span>
                                </div>
                                <div class="top-winner-item">
                                    <span>#3 ---</span>
                                    <span>---</span>
                                </div>
                            </div>
                            <div class="your-results">
                                <h4>Your Results</h4>
                                <div class="result-item">
                                    <span class="label">Total Bet:</span>
                                    <span class="value" id="modalYourBet">0.00 SOL ($0.00)</span>
                                </div>
                                <div class="result-item">
                                    <span class="label">Winnings:</span>
                                    <span class="value positive" id="modalYourWinnings">+0.00 SOL ($0.00)</span>
                                </div>
                                <div class="result-item">
                                    <span class="label">Net Result:</span>
                                    <span class="value positive" id="modalNetResult">+0.00 SOL ($0.00)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Betting Panel -->
        <div class="betting-panel">
            <div class="panel-header">
                <h2>Place Your Bets</h2>
            </div>
            
            <!-- Character Selection -->
            <div class="character-selection">
                <div class="selected-character" id="selectedCharacter">
                    <h3 id="selectedCharacterName">Select a Character</h3>
                </div>
                <div class="character-grid" id="characterGrid"></div>
            </div>
            
            <!-- Betting Options -->
            <div class="betting-options">
                <div class="quick-bets">
                    <h4>Quick Bets</h4>
                    <div class="quick-bet-buttons">
                        <button class="quick-bet-btn" data-amount="1">1 SOL</button>
                        <button class="quick-bet-btn" data-amount="3">3 SOL</button>
                        <button class="quick-bet-btn" data-amount="5">5 SOL</button>
                        <input type="number" id="customBetAmount" placeholder="_ SOL" min="0.1" step="0.1">
                    </div>
                    <button class="place-bet-btn" id="placeBetBtn">Place Bet - 0.0 SOL</button>
                </div>
            </div>
            
            <!-- Live Odds Display -->
            <div class="odds-display">
                <div class="odds-grid" id="oddsGrid">
                    <!-- Odds items will be populated here by JavaScript -->
                </div>
            </div>
            
            <!-- Live Betting Distribution -->
            <div class="betting-distribution">
                <h3>Live Betting Distribution</h3>
                
                <!-- Pie Chart Container -->
                <div class="pie-chart-container">
                    <div class="pie-chart-visual"></div>
                    <div class="pie-chart-center"></div>
                </div>
                
                <!-- Favorite Info -->
                <div class="favorite-info">
                    <span>Favorite: </span>
                    <span class="favorite-text">None (0%)</span>
                </div>
                
                <!-- Legend Container -->
                <div class="distribution-legend"></div>
            </div>
        </div>
    </div>

    <!-- Deposit Modal -->
    <div class="deposit-modal" id="depositModal">
        <div class="deposit-content">
            <div class="deposit-header">
                <h2>Deposit</h2>
                <button class="close-btn" id="closeDepositModal">√ó</button>
            </div>
            
            <div class="deposit-body">
                <div class="token-section">
                    <label>Token</label>
                    <div class="token-selector">
                        <div class="token-option selected">
                            <div class="token-icon">‚óé</div>
                            <div class="token-info">
                                <span class="token-name">SOL</span>
                                <span class="token-label">Solana</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="balance-section">
                    <div class="balance-info">
                        <span class="balance-usd" id="walletBalanceUSD">‚âà $0.00 USD</span>
                        <span class="balance-amount" id="walletBalance">Balance: 0.000 SOL</span>
                    </div>
                </div>
                
                <div class="amount-section">
                    <label>Amount</label>
                    <div class="amount-input-container">
                        <input type="number" id="depositAmount" placeholder="0.00" step="0.01" min="0.01">
                        <span class="amount-usd">= $0.00</span>
                        <div class="token-unit">‚óé</div>
                    </div>
                </div>
                
                <div class="fee-info">
                    <span class="fee-text">Enjoy 0% fees on SOL deposits & withdrawals!</span>
                </div>
                
                <button class="deposit-action-btn" id="confirmDepositBtn">
                    DEPOSIT NOW
                </button>
            </div>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div class="deposit-modal" id="withdrawModal">
        <div class="deposit-content">
            <div class="deposit-header">
                <h2>Withdraw</h2>
                <button class="close-btn" id="closeWithdrawModal">√ó</button>
            </div>
            
            <div class="deposit-body">
                <div class="token-section">
                    <label>Token</label>
                    <div class="token-selector">
                        <div class="token-option selected">
                            <div class="token-icon">‚óé</div>
                            <div class="token-info">
                                <span class="token-name">SOL</span>
                                <span class="token-label">Solana</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="balance-section">
                    <div class="balance-info">
                        <span class="balance-usd" id="platformBalanceUSD">‚âà $0.00 USD</span>
                        <span class="balance-amount" id="platformBalance">Platform Balance: 0.000 SOL</span>
                    </div>
                </div>
                
                <div class="amount-section">
                    <label>Amount</label>
                    <div class="amount-input-container">
                        <input type="number" id="withdrawAmount" placeholder="0.00" step="0.01" min="0.01">
                        <span class="amount-usd">= $0.00</span>
                        <div class="token-unit">‚óé</div>
                    </div>
                </div>
                
                <div class="fee-info">
                    <span class="fee-text">Enjoy 0% fees on SOL deposits & withdrawals!</span>
                </div>
                
                <button class="deposit-action-btn" id="confirmWithdrawBtn">
                    WITHDRAW NOW
                </button>
            </div>
        </div>
    </div>

    <!-- Countdown Display Element -->
    <div id="countdownDisplay" style="
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
      background: rgba(0,0,0,0.8);
      padding: 40px;
      border-radius: 20px;
      text-align: center;
    ">
    </div>

  <!-- Privy SDK Loader -->
  <script src="/js/privy-loader.js"></script>
  
  <!-- Mock Privy Fallback -->
  <script src="/js/mock-privy.js"></script>
  
  <!-- Socket.IO -->
  <script src="/socket.io/socket.io.js"></script>
  
  <!-- Solana Web3.js -->
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>

  <!-- Configuration (load before modules) -->
  <script src="/js/config.js"></script>

  <!-- Main Application Script -->
  <script type="module" src="/js/main.js"></script>
</body>
</html>