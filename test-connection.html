<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Connection Test</title>
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>ðŸ”Œ WebSocket Connection Test</h1>
    <div id="status">Not connected</div>
    <button onclick="testConnection()">Test Connection</button>
    <button onclick="clearLog()">Clear Log</button>
    <div id="log"></div>

    <script>
        const CONFIG = {
            WS_URL: 'https://racers-production.up.railway.app'
        };

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toISOString();
            logDiv.innerHTML += `<div class="log ${type}">[${timestamp}] ${message}</div>`;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function updateStatus(status) {
            document.getElementById('status').textContent = status;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function testConnection() {
            log('ðŸš€ Starting WebSocket connection test...', 'info');
            updateStatus('Testing connection...');
            
            log(`ðŸ”— Connecting to: ${CONFIG.WS_URL}`, 'info');
            
            const socket = io(CONFIG.WS_URL, {
                auth: {
                    token: null // No auth for testing
                },
                timeout: 10000,
                forceNew: true
            });

            socket.on('connect', () => {
                log('âœ… SUCCESS: Connected to WebSocket!', 'success');
                log(`ðŸ“¡ Socket ID: ${socket.id}`, 'info');
                updateStatus('Connected âœ…');
            });

            socket.on('disconnect', (reason) => {
                log(`âŒ Disconnected: ${reason}`, 'error');
                updateStatus('Disconnected âŒ');
            });

            socket.on('connect_error', (error) => {
                log(`âŒ Connection Error: ${error.message}`, 'error');
                log(`ðŸ” Error details: ${JSON.stringify(error)}`, 'error');
                updateStatus('Connection Error âŒ');
            });

            socket.on('race_state', (data) => {
                log(`ðŸ Race state received: ${JSON.stringify(data)}`, 'success');
            });

            socket.on('race_update', (data) => {
                log(`ðŸƒ Race update: ${JSON.stringify(data)}`, 'info');
            });

            socket.on('race_started', (data) => {
                log(`ðŸš€ Race started: ${JSON.stringify(data)}`, 'success');
            });

            socket.on('race_ended', (data) => {
                log(`ðŸ† Race ended: ${JSON.stringify(data)}`, 'success');
            });

            // Test after 5 seconds
            setTimeout(() => {
                if (socket.connected) {
                    log('âœ… Connection test PASSED!', 'success');
                } else {
                    log('âŒ Connection test FAILED!', 'error');
                }
            }, 5000);
        }

        // Auto-test on page load
        window.onload = () => {
            log('ðŸ“„ Page loaded, ready to test connection', 'info');
        };
    </script>
</body>
</html>