<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Debug</title>
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
</head>
<body>
    <h1>WebSocket Debug Test</h1>
    <div id="status">Not connected</div>
    <div id="log"></div>
    <button onclick="connect()">Connect</button>
    <button onclick="disconnect()">Disconnect</button>

    <script>
        const CONFIG = {
            WS_URL: 'https://racers-production.up.railway.app'
        };

        let socket = null;

        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += '<div>' + new Date().toISOString() + ': ' + message + '</div>';
            console.log(message);
        }

        function updateStatus(status) {
            document.getElementById('status').textContent = status;
        }

        function connect() {
            log('Attempting to connect...');
            updateStatus('Connecting...');
            
            socket = io(CONFIG.WS_URL, {
                auth: {
                    token: null // No auth for testing
                }
            });

            socket.on('connect', () => {
                log('‚úÖ Connected! Socket ID: ' + socket.id);
                updateStatus('Connected');
            });

            socket.on('disconnect', (reason) => {
                log('‚ùå Disconnected: ' + reason);
                updateStatus('Disconnected');
            });

            socket.on('connect_error', (error) => {
                log('‚ùå Connection error: ' + error.message);
                updateStatus('Connection Error');
            });

            socket.on('race_state', (data) => {
                log('üèÅ Race state: ' + JSON.stringify(data));
            });

            socket.on('race_update', (data) => {
                log('üèÉ Race update: ' + JSON.stringify(data));
            });
        }

        function disconnect() {
            if (socket) {
                socket.disconnect();
                socket = null;
                log('Disconnected manually');
                updateStatus('Disconnected');
            }
        }
    </script>
</body>
</html>
